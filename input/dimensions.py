import numpy as np
import xarray as xr

lat = [-87.86379884, -85.09652699, -82.31291295, -79.52560657,\
       -76.73689968, -73.94751515, -71.15775201, -68.36775611,\
       -65.57760701, -62.7873518 , -59.99702011, -57.20663153,\
       -54.41619953, -51.62573367, -48.83524097, -46.04472663,\
       -43.25419467, -40.46364818, -37.67308963, -34.88252099,\
       -32.09194388, -29.30135962, -26.51076933, -23.72017393,\
       -20.92957425, -18.13897099, -15.34836476, -12.55775612,\
        -9.76714556,  -6.97653355,  -4.18592053,  -1.39530691,\
         1.39530691,   4.18592053,   6.97653355,   9.76714556,\
        12.55775612,  15.34836476,  18.13897099,  20.92957425,\
        23.72017393,  26.51076933,  29.30135962,  32.09194388,\
        34.88252099,  37.67308963,  40.46364818,  43.25419467,\
        46.04472663,  48.83524097,  51.62573367,  54.41619953,\
        57.20663153,  59.99702011,  62.7873518 ,  65.57760701,\
        68.36775611,  71.15775201,  73.94751515,  76.73689968,\
        79.52560657,  82.31291295,  85.09652699,  87.86379884]

latb = [-9.00000000e+01, -8.65777475e+01, -8.37570288e+01, -8.09550202e+01,\
       -7.81583479e+01, -7.53639386e+01, -7.25707002e+01, -6.97781462e+01,\
       -6.69860267e+01, -6.41942004e+01, -6.14025809e+01, -5.86111130e+01,\
       -5.58197590e+01, -5.30284931e+01, -5.02372963e+01, -4.74461548e+01,\
       -4.46550580e+01, -4.18639979e+01, -3.90729682e+01, -3.62819638e+01,\
       -3.34909806e+01, -3.07000152e+01, -2.79090649e+01, -2.51181273e+01,\
       -2.23272004e+01, -1.95362826e+01, -1.67453722e+01, -1.39544680e+01,\
       -1.11635687e+01, -8.37267325e+00, -5.58178063e+00, -2.79088986e+00,\
       -3.18055468e-14,  2.79088986e+00,  5.58178063e+00,  8.37267325e+00,\
        1.11635687e+01,  1.39544680e+01,  1.67453722e+01,  1.95362826e+01,\
        2.23272004e+01,  2.51181273e+01,  2.79090649e+01,  3.07000152e+01,\
        3.34909806e+01,  3.62819638e+01,  3.90729682e+01,  4.18639979e+01,\
        4.46550580e+01,  4.74461548e+01,  5.02372963e+01,  5.30284931e+01,\
        5.58197590e+01,  5.86111130e+01,  6.14025809e+01,  6.41942004e+01,\
        6.69860267e+01,  6.97781462e+01,  7.25707002e+01,  7.53639386e+01,\
        7.81583479e+01,  8.09550202e+01,  8.37570288e+01,  8.65777475e+01,\
        9.00000000e+01]

lon = [  0.    ,   2.8125,   5.625 ,   8.4375,  11.25  ,  14.0625,\
        16.875 ,  19.6875,  22.5   ,  25.3125,  28.125 ,  30.9375,\
        33.75  ,  36.5625,  39.375 ,  42.1875,  45.    ,  47.8125,\
        50.625 ,  53.4375,  56.25  ,  59.0625,  61.875 ,  64.6875,\
        67.5   ,  70.3125,  73.125 ,  75.9375,  78.75  ,  81.5625,\
        84.375 ,  87.1875,  90.    ,  92.8125,  95.625 ,  98.4375,\
       101.25  , 104.0625, 106.875 , 109.6875, 112.5   , 115.3125,\
       118.125 , 120.9375, 123.75  , 126.5625, 129.375 , 132.1875,\
       135.    , 137.8125, 140.625 , 143.4375, 146.25  , 149.0625,\
       151.875 , 154.6875, 157.5   , 160.3125, 163.125 , 165.9375,\
       168.75  , 171.5625, 174.375 , 177.1875, 180.    , 182.8125,\
       185.625 , 188.4375, 191.25  , 194.0625, 196.875 , 199.6875,\
       202.5   , 205.3125, 208.125 , 210.9375, 213.75  , 216.5625,\
       219.375 , 222.1875, 225.    , 227.8125, 230.625 , 233.4375,\
       236.25  , 239.0625, 241.875 , 244.6875, 247.5   , 250.3125,\
       253.125 , 255.9375, 258.75  , 261.5625, 264.375 , 267.1875,\
       270.    , 272.8125, 275.625 , 278.4375, 281.25  , 284.0625,\
       286.875 , 289.6875, 292.5   , 295.3125, 298.125 , 300.9375,\
       303.75  , 306.5625, 309.375 , 312.1875, 315.    , 317.8125,\
       320.625 , 323.4375, 326.25  , 329.0625, 331.875 , 334.6875,\
       337.5   , 340.3125, 343.125 , 345.9375, 348.75  , 351.5625,\
       354.375 , 357.1875]

lonb = [ -1.40625,   1.40625,   4.21875,   7.03125,   9.84375,  12.65625,\
        15.46875,  18.28125,  21.09375,  23.90625,  26.71875,  29.53125,\
        32.34375,  35.15625,  37.96875,  40.78125,  43.59375,  46.40625,\
        49.21875,  52.03125,  54.84375,  57.65625,  60.46875,  63.28125,\
        66.09375,  68.90625,  71.71875,  74.53125,  77.34375,  80.15625,\
        82.96875,  85.78125,  88.59375,  91.40625,  94.21875,  97.03125,\
        99.84375, 102.65625, 105.46875, 108.28125, 111.09375, 113.90625,\
       116.71875, 119.53125, 122.34375, 125.15625, 127.96875, 130.78125,\
       133.59375, 136.40625, 139.21875, 142.03125, 144.84375, 147.65625,\
       150.46875, 153.28125, 156.09375, 158.90625, 161.71875, 164.53125,\
       167.34375, 170.15625, 172.96875, 175.78125, 178.59375, 181.40625,\
       184.21875, 187.03125, 189.84375, 192.65625, 195.46875, 198.28125,\
       201.09375, 203.90625, 206.71875, 209.53125, 212.34375, 215.15625,\
       217.96875, 220.78125, 223.59375, 226.40625, 229.21875, 232.03125,\
       234.84375, 237.65625, 240.46875, 243.28125, 246.09375, 248.90625,\
       251.71875, 254.53125, 257.34375, 260.15625, 262.96875, 265.78125,\
       268.59375, 271.40625, 274.21875, 277.03125, 279.84375, 282.65625,\
       285.46875, 288.28125, 291.09375, 293.90625, 296.71875, 299.53125,\
       302.34375, 305.15625, 307.96875, 310.78125, 313.59375, 316.40625,\
       319.21875, 322.03125, 324.84375, 327.65625, 330.46875, 333.28125,\
       336.09375, 338.90625, 341.71875, 344.53125, 347.34375, 350.15625,\
       352.96875, 355.78125, 358.59375]

pfull = [2.84191e-01, 3.25350e-01, 3.71936e-01, 4.24615e-01, 4.84153e-01,\
       5.51432e-01, 6.27490e-01, 7.13542e-01, 8.11039e-01, 9.21699e-01,\
       1.04757e+00, 1.19108e+00, 1.35511e+00, 1.54305e+00, 1.75891e+00,\
       2.00739e+00, 2.29403e+00, 2.62529e+00, 3.00884e+00, 3.45369e+00,\
       3.97050e+00, 4.57190e+00, 5.27278e+00, 6.09073e+00, 7.04636e+00,\
       8.16371e+00, 9.47075e+00, 1.10000e+01, 1.27894e+01, 1.48832e+01,\
       1.73342e+01, 2.02039e+01, 2.35659e+01, 2.75066e+01, 3.21283e+01,\
       3.75509e+01, 4.39150e+01, 5.13840e+01, 6.01483e+01, 7.04289e+01,\
       8.24830e+01, 9.66096e+01, 1.13155e+02, 1.32514e+02, 1.55122e+02,\
       1.81445e+02, 2.11947e+02, 2.47079e+02, 2.87273e+02, 3.32956e+02,\
       3.84573e+02, 4.42610e+02, 5.07601e+02, 5.80132e+02, 6.60837e+02,\
       7.50393e+02, 8.49521e+02, 9.58981e+02, 1.00369e+03]

phalf = [2.65458e-01, 3.04131e-01, 3.47925e-01, 3.97468e-01, 4.53475e-01,\
       5.16764e-01, 5.88292e-01, 6.69182e-01, 7.60760e-01, 8.64604e-01,\
       9.82590e-01, 1.11695e+00, 1.27033e+00, 1.44585e+00, 1.64721e+00,\
       1.87875e+00, 2.14556e+00, 2.45363e+00, 2.81000e+00, 3.22298e+00,\
       3.70236e+00, 4.25975e+00, 4.90887e+00, 5.66591e+00, 6.54992e+00,\
       7.58317e+00, 8.79160e+00, 1.02054e+01, 1.18595e+01, 1.37952e+01,\
       1.60604e+01, 1.87124e+01, 2.18183e+01, 2.54579e+01, 2.97253e+01,\
       3.47312e+01, 4.06056e+01, 4.75001e+01, 5.55912e+01, 6.50839e+01,\
       7.62167e+01, 8.92667e+01, 1.04556e+02, 1.22456e+02, 1.43383e+02,\
       1.67790e+02, 1.96144e+02, 2.28907e+02, 2.66517e+02, 3.09401e+02,\
       3.57993e+02, 4.12756e+02, 4.74200e+02, 5.42885e+02, 6.19422e+02,\
       7.04465e+02, 7.98713e+02, 9.02909e+02, 9.81130e+02, 1.01300e+03]

def make_3d(ozone_ds):
    data = np.zeros([len(pfull), len(lat), len(lon)])

    print("make ds")
    ds = xr.Dataset(
        data_vars=dict(
            data=(["pfull","lat","lon"], data)
        ),
        coords=dict(
            lat=("lat", lat),
            lon=("lon", lon),
            latb=("latb", latb),
            lonb=("lonb", lonb),
            pfull=("pfull", pfull),
            phalf=("phalf", phalf)
        ),
    )

    print("apply attributes")
    ds = xr.merge([ds, ozone_ds], compat='override', join='left', combine_attrs='drop_conflicts')

    print("to netcdf")
    ds.to_netcdf('/home/links/rm811/Isca/input/' + 'dimensions.nc', format="NETCDF3_CLASSIC",
        encoding = {"data": {"dtype": 'float32', '_FillValue': None},
                        "lat": {'_FillValue': None}, "lon": {'_FillValue': None},
                        "latb": {'_FillValue': None}, "lonb": {'_FillValue': None},
                        "pfull": {'_FillValue': None}, "phalf": {'_FillValue': None}}
                    )
    
    return ds

def make_2d(ozone_ds):

    data = np.zeros([len(lat), len(lon)])

    print("make ds")
    ds = xr.Dataset(
        data_vars=dict(
            data=(["lat","lon"], data)
        ),
        coords=dict(
            lat=("lat", lat),
            lon=("lon", lon),
            latb=("latb", latb),
            lonb=("lonb", lonb)
        ),
    )

    ozone_ds = ozone_ds.drop('ozone_1990')
    ozone_ds = ozone_ds.drop('pfull')
    ozone_ds = ozone_ds.drop('phalf')

    print("apply attributes")
    ds = xr.merge([ds, ozone_ds], compat='override', join='left', combine_attrs='drop_conflicts')

    print("to netcdf")
    ds.to_netcdf('/home/links/rm811/Isca/input/' + 'dimensions_2d.nc', format="NETCDF3_CLASSIC",
        encoding = {"data": {"dtype": 'float32', '_FillValue': None},
                        "lat": {'_FillValue': None}, "lon": {'_FillValue': None},
                        "latb": {'_FillValue': None}, "lonb": {'_FillValue': None}}
                    )
    
    return ds

if __name__ == '__main__': 
    option = input("a) 2d or b) 3d grid?")

    ozone_file = '/home/links/rm811/Isca/input/rrtm_input_files/ozone_1990_notime.nc'
    ozone_ds = xr.open_dataset(ozone_file, decode_times=False)

    H = 8
    p0 = 1000

    if option =='a':
        make_2d(ozone_ds)
    elif option =='b':
        make_3d(ozone_ds)